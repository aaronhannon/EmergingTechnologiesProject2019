<!DOCTYPE html>
<html>

<head>
    <style>
        .paint-canvas {
        border: 1px black solid;
        display: block;
        margin: 1rem;
        }

        .js-color-picker {
        margin: 1rem 1rem 0 1rem;
        }
        </style>
</head>

<body>

    <body onload="init()">
        <input type="color"  class="js-color-picker">
        <input type="range" class="js-line-range" min="1" max="72" value="1">
        <label class="js-range-value">1</label>Px
        <canvas class="js-paint  paint-canvas" width="600" height="300"></canvas>
        <input type="button" value="save" id="predict" size="30" style="position:absolute;top:55%;left:10%;">
        <input type="button" value="clear" id="clr" size="23" onclick="erase()" style="position:absolute;top:55%;left:15%;">


</body>
<script
    src="https://code.jquery.com/jquery-3.2.1.js"
    integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
    crossorigin="anonymous">
</script>
<script type="text/javascript">
    const paintCanvas = document.querySelector( '.js-paint' );
    const context = paintCanvas.getContext( '2d' );
    context.lineCap = 'round';

    const colorPicker = document.querySelector( '.js-color-picker');

    colorPicker.addEventListener( 'change', event => {
        context.strokeStyle = event.target.value; 
    } );

    const lineWidthRange = document.querySelector( '.js-line-range' );
    const lineWidthLabel = document.querySelector( '.js-range-value' );

    lineWidthRange.addEventListener( 'input', event => {
        const width = event.target.value;
        lineWidthLabel.innerHTML = width;
        context.lineWidth = width;
    } );

    let x = 0, y = 0;
    let isMouseDown = false;

    const stopDrawing = () => { isMouseDown = false; }
    const startDrawing = event => {
        isMouseDown = true;   
    [x, y] = [event.offsetX, event.offsetY];  
    }
    const drawLine = event => {
        if ( isMouseDown ) {
            const newX = event.offsetX;
            const newY = event.offsetY;
            context.beginPath();
            context.moveTo( x, y );
            context.lineTo( newX, newY );
            context.stroke();
            [x, y] = [newX, newY];
        }
    }

    paintCanvas.addEventListener( 'mousedown', startDrawing );
    paintCanvas.addEventListener( 'mousemove', drawLine );
    paintCanvas.addEventListener( 'mouseup', stopDrawing );
    paintCanvas.addEventListener( 'mouseout', stopDrawing );

    var server = "http://127.0.0.1:5000";
    
    $( function() {
				$( "#predict" ).click(function() {
					var appdir='/';
					var send_msg = paintCanvas.toDataURL();
					var received_msg = "<p>Result returned</p>";
					console.log(send_msg);
					$.ajax({
  						type: "POST",
  						url:server+appdir,
  						data: {
                            imageBase64: send_msg
                          }
					}).done(function(data) { 
						console.log(data);
						
					});
				});
  			});
    
    </script>
</html>